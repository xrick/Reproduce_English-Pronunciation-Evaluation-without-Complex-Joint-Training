å®Œç¾ï¼NVIDIA TITAN RTX æ˜¯å¾ˆå¥½çš„ GPUã€‚è®“æˆ‘æ ¹æ“šä½ çš„ç¡¬ä»¶è¦æ ¼çµ¦å‡ºå„ªåŒ–å»ºè­°ï¼š
ğŸ–¥ï¸ NVIDIA TITAN RTX è¦æ ¼
GPU: NVIDIA TITAN RTX
è¨˜æ†¶é«”: 24GB GDDR6
CUDA æ ¸å¿ƒ: 4,608
æ¶æ§‹: Turing (Compute Capability 7.5)
CUDA ç‰ˆæœ¬: 12.8
é©…å‹•ç‰ˆæœ¬: 570.124.06
âš ï¸ é‡è¦ï¼šç²¾åº¦è¨­ç½®
TITAN RTX æ˜¯ Turing æ¶æ§‹ï¼ŒCompute Capability 7.5ï¼š
âŒ ä¸æ”¯æŒ BF16ï¼ˆéœ€è¦ Ampere 8.0+ï¼‰
âœ… æ”¯æŒ FP16
âœ… æœ€ä½³è¨“ç·´é…ç½®
æ¨è–¦å‘½ä»¤

# è«–æ–‡é…ç½® (r=64) - ä½¿ç”¨ FP16
python src/train_single_config_remote.py \
  --config paper_r64 \
  --gpus 0 \
  --fp16 \
  --batch-size 8 \
  --gradient-accumulation 8

# é è¨“ç·´é…ç½® (r=320)
python src/train_single_config_remote.py \
  --config pretrained_r320 \
  --gpus 0 \
  --fp16 \
  --batch-size 6 \
  --gradient-accumulation 10
ç‚ºä»€éº¼ä½¿ç”¨ --fp16ï¼Ÿ

# train_single_config_remote.py æœƒè‡ªå‹•æª¢æ¸¬ï¼š
compute_capability = torch.cuda.get_device_capability()
# TITAN RTX = (7, 5)
if compute_capability[0] < 8:  # å°æ–¼ 8.0
    use_fp16 = True   âœ… è‡ªå‹•åˆ‡æ›åˆ° FP16
    use_bf16 = False
ä½†ç‚ºäº†ç¢ºä¿ï¼Œæ˜ç¢ºæŒ‡å®š --fp16 æ›´å®‰å…¨ã€‚
ğŸ“Š æ‰¹æ¬¡å¤§å°å»ºè­°
åŸºæ–¼ 24GB è¨˜æ†¶é«”ï¼š
é…ç½®	æ‰¹æ¬¡å¤§å°	æ¢¯åº¦ç´¯ç©	æœ‰æ•ˆæ‰¹æ¬¡	é ä¼° VRAM
paper_r64 (æ¨è–¦)	8	8	64	~18GB
paper_r64 (å®‰å…¨)	6	10	60	~14GB
pretrained_r320	6	10	60	~20GB
pretrained_r320 (å®‰å…¨)	4	16	64	~16GB
â±ï¸ é ä¼°è¨“ç·´æ™‚é–“
TITAN RTX (24GB, FP16):
paper_r64: ç´„ 3-4 å°æ™‚ï¼ˆ3 epochsï¼‰
pretrained_r320: ç´„ 4-5 å°æ™‚ï¼ˆ3 epochsï¼‰
æ¯” Mac å¿« 2-3 å€ï¼
ğŸš€ å®Œæ•´å•Ÿå‹•æµç¨‹
1. ä¿®å¾©æ¨¡å‹è·¯å¾‘ï¼ˆä¸€æ¬¡æ€§ï¼‰

cd /datas/store162/xrick/prjs/Reproduce_English_Pronunciation_Evaluation

# æ–¹æ³• 1: Python è‡ªå‹•ä¿®å¾©ï¼ˆæ¨è–¦ï¼‰
python3 << 'EOF'
import re

for file in ['src/model_utility_configs.py', 'src/model_utility.py']:
    try:
        with open(file, 'r') as f:
            content = f.read()
        
        pattern = r'model_path\s*=\s*["\'].*?["\']'
        replacement = 'model_path = "microsoft/phi-4-multimodal-instruct"'
        content = re.sub(pattern, replacement, content)
        
        with open(file, 'w') as f:
            f.write(content)
        print(f"âœ… {file} å·²æ›´æ–°")
    except FileNotFoundError:
        pass
EOF
2. å•Ÿå‹•è¨“ç·´

# æ¿€æ´»ç’°å¢ƒ
source venv/bin/activate

# æª¢æŸ¥ GPU
nvidia-smi

# é–‹å§‹è¨“ç·´ï¼ˆè«–æ–‡é…ç½®ï¼‰
python src/train_single_config_remote.py \
  --config paper_r64 \
  --gpus 0 \
  --fp16 \
  --batch-size 8 \
  --gradient-accumulation 8
3. ç›£æ§è¨“ç·´
çµ‚ç«¯ 1: è¨“ç·´é€²ç¨‹

python src/train_single_config_remote.py --config paper_r64 --gpus 0 --fp16
çµ‚ç«¯ 2: GPU ç›£æ§

watch -n 1 nvidia-smi
çµ‚ç«¯ 3: TensorBoardï¼ˆå¯é¸ï¼‰

tensorboard --logdir src/output/paper_r64/logs --port 6007
ğŸ”§ å¦‚æœè¨˜æ†¶é«”ä¸è¶³ï¼ˆOOMï¼‰
æ–¹æ¡ˆ 1: æ¸›å°æ‰¹æ¬¡å¤§å°

python src/train_single_config_remote.py \
  --config paper_r64 \
  --gpus 0 \
  --fp16 \
  --batch-size 4 \
  --gradient-accumulation 16
æ–¹æ¡ˆ 2: å•Ÿç”¨æ¢¯åº¦æª¢æŸ¥é»ï¼ˆå·²é»˜èªå•Ÿç”¨ï¼‰
è¨“ç·´è…³æœ¬å·²ç¶“åŒ…å«ï¼š

gradient_checkpointing=True  # å·²å•Ÿç”¨
ğŸ“ˆ é æœŸè¼¸å‡º
æˆåŠŸå•Ÿå‹•å¾Œï¼Œä½ æœƒçœ‹åˆ°ï¼š

ğŸ–¥ï¸  Remote Training Configuration
================================================================================
è¨“ç·´é…ç½®: paper_r64
GPU è¨­å‚™: 0 (1 GPU(s))
CUDA å¯ç”¨: True
CUDA ç‰ˆæœ¬: 12.8
  GPU 0: NVIDIA TITAN RTX
  å…§å­˜: 24.00 GB
================================================================================

ğŸ“Š ã€è«–æ–‡é…ç½® r=64ã€‘åƒæ•¸çµ±è¨ˆ:
  ç¸½åƒæ•¸: 5,205,361,472
  å¯è¨“ç·´åƒæ•¸: 461,373,440 (8.8634%)
  Speech LoRA: r=64, alpha=128, dp=0.05
  ç²¾åº¦: FP16

è¼‰å…¥è¨“ç·´æ•¸æ“šé›†...
è¨“ç·´æ¨£æœ¬æ•¸: 2500

ğŸš€ é–‹å§‹è¨“ç·´...
================================================================================

Epoch 1/3:   0%|          | 0/40 [00:00<?, ?it/s]
âœ… å®Œæ•´æª¢æŸ¥æ¸…å–®
è¨“ç·´å‰ç¢ºèªï¼š
 å·²ä¿®å¾© model_pathï¼ˆä½¿ç”¨åœ¨ç·šæ¨¡å‹ï¼‰
 å·²æ¿€æ´»è™›æ“¬ç’°å¢ƒï¼šsource venv/bin/activate
 GPU å¯è¦‹ï¼šnvidia-smi é¡¯ç¤º TITAN RTX
 ä½¿ç”¨æ­£ç¢ºè…³æœ¬ï¼štrain_single_config_remote.py
 æŒ‡å®š --fp16ï¼ˆé‡è¦ï¼ï¼‰
 æ•¸æ“šé›†è·¯å¾‘æ­£ç¢º
ğŸ¯ æ¨è–¦é…ç½®ç¸½çµ
æœ€ä½³è¨“ç·´å‘½ä»¤ï¼ˆè¤‡è£½è²¼ä¸Šå³å¯ï¼‰ï¼š

source venv/bin/activate && \
python src/train_single_config_remote.py \
  --config paper_r64 \
  --gpus 0 \
  --fp16 \
  --batch-size 8 \
  --gradient-accumulation 8 \
  --epochs 3 \
  --learning-rate 2e-5
é€™å€‹é…ç½®ï¼š
âœ… ç¬¦åˆè«–æ–‡è¦æ ¼
âœ… å……åˆ†åˆ©ç”¨ 24GB VRAM
âœ… ä½¿ç”¨ FP16ï¼ˆTITAN RTX æœ€ä½³ï¼‰
âœ… é è¨ˆ 3-4 å°æ™‚å®Œæˆ
